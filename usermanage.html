<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GetInTheCar ‚Äî User Management</title>
<link rel="stylesheet" href="style.css">
<style>
/* User Management Specific Styles */
.management-header {
  background: rgba(255, 255, 255, 0.03);
  border-bottom: 1px solid rgba(255, 85, 85, 0.1);
  padding: 24px;
  backdrop-filter: blur(10px);
}

.header-title {
  font-size: 28px;
  font-weight: 800;
  background: linear-gradient(90deg, #ff5555, #ffdd00);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 8px;
}

.management-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
  flex-wrap: wrap;
  gap: 16px;
}

.filter-controls {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.filter-select {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 85, 85, 0.2);
  border-radius: 8px;
  padding: 10px 16px;
  color: var(--text);
  font-size: 14px;
  min-width: 150px;
}

.filter-select:focus {
  outline: none;
  border-color: #ff5555;
  box-shadow: 0 0 0 2px rgba(255, 85, 85, 0.2);
}

.search-input {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 85, 85, 0.2);
  border-radius: 8px;
  padding: 10px 16px;
  color: var(--text);
  font-size: 14px;
  min-width: 250px;
}

.search-input:focus {
  outline: none;
  border-color: #ff5555;
  box-shadow: 0 0 0 2px rgba(255, 85, 85, 0.2);
}

.action-buttons {
  display: flex;
  gap: 12px;
}

/* User Table */
.user-table-container {
  background: rgba(255, 255, 255, 0.03);
  border: 1px solid rgba(255, 85, 85, 0.1);
  border-radius: 16px;
  padding: 20px;
  margin: 20px;
  backdrop-filter: blur(10px);
}

.user-table {
  width: 100%;
  border-collapse: collapse;
}

.user-table th {
  text-align: left;
  padding: 16px;
  font-size: 12px;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-bottom: 1px solid rgba(255, 85, 85, 0.1);
  background: rgba(255, 255, 255, 0.02);
}

.user-table td {
  padding: 16px;
  border-bottom: 1px solid rgba(255, 85, 85, 0.05);
  font-size: 14px;
}

.user-table tr {
  transition: all 0.2s;
}

.user-table tr:hover {
  background: rgba(255, 85, 85, 0.05);
}

/* User Avatar */
.user-avatar-cell {
  display: flex;
  align-items: center;
  gap: 12px;
}

.user-avatar {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, #ff5555, #ffdd00);
  color: #0a0a0f;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 800;
  font-size: 16px;
}

/* Status Badges */
.status-badge {
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  display: inline-block;
}

.status-online {
  background: rgba(76, 175, 80, 0.15);
  color: #4CAF50;
  border: 1px solid rgba(76, 175, 80, 0.3);
}

.status-offline {
  background: rgba(255, 107, 107, 0.15);
  color: #ff6b6b;
  border: 1px solid rgba(255, 107, 107, 0.3);
}

.status-inride {
  background: rgba(255, 221, 0, 0.15);
  color: #ffdd00;
  border: 1px solid rgba(255, 221, 0, 0.3);
}

.status-suspended {
  background: rgba(159, 168, 218, 0.15);
  color: #9fa8da;
  border: 1px solid rgba(159, 168, 218, 0.3);
}

/* Action Buttons */
.action-buttons-cell {
  display: flex;
  gap: 8px;
}

.action-btn {
  width: 36px;
  height: 36px;
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 85, 85, 0.1);
  color: var(--text);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 14px;
}

.action-btn:hover {
  background: rgba(255, 85, 85, 0.1);
  border-color: rgba(255, 85, 85, 0.3);
  color: #ff5555;
}

.action-btn.edit:hover {
  color: #ffdd00;
}

.action-btn.delete:hover {
  color: #ff6b6b;
}

.action-btn.view:hover {
  color: #4CAF50;
}

/* Stats Cards */
.user-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin: 20px;
}

.stat-card {
  background: rgba(255, 255, 255, 0.03);
  border: 1px solid rgba(255, 85, 85, 0.1);
  border-radius: 12px;
  padding: 24px;
  text-align: center;
  transition: all 0.2s;
}

.stat-card:hover {
  background: rgba(255, 85, 85, 0.05);
  border-color: rgba(255, 85, 85, 0.2);
  transform: translateY(-2px);
}

.stat-value {
  font-size: 36px;
  font-weight: 800;
  margin-bottom: 8px;
  background: linear-gradient(90deg, #ff5555, #ffdd00);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.stat-label {
  font-size: 14px;
  color: var(--muted);
  margin-bottom: 4px;
}

.stat-change {
  font-size: 12px;
  color: var(--muted);
}

.stat-change.positive {
  color: #4CAF50;
}

.stat-change.negative {
  color: #ff6b6b;
}

/* Pagination */
.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
  margin-top: 24px;
  padding-top: 20px;
  border-top: 1px solid rgba(255, 85, 85, 0.1);
}

.page-btn {
  width: 36px;
  height: 36px;
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 85, 85, 0.1);
  color: var(--text);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 14px;
}

.page-btn:hover {
  background: rgba(255, 85, 85, 0.1);
  border-color: rgba(255, 85, 85, 0.3);
}

.page-btn.active {
  background: linear-gradient(135deg, #ff5555, #ffdd00);
  color: #0a0a0f;
  border-color: transparent;
}

.page-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Modal Styles */
.modal-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  backdrop-filter: blur(4px);
}

.user-modal {
  background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%);
  border: 1px solid rgba(255, 85, 85, 0.15);
  border-radius: 16px;
  width: 90%;
  max-width: 600px;
  max-height: 90vh;
  overflow-y: auto;
  padding: 32px;
  color: var(--text);
  box-shadow: 0 20px 60px rgba(255, 59, 48, 0.15), 
              0 0 0 1px rgba(255, 221, 0, 0.1);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
  padding-bottom: 16px;
  border-bottom: 1px solid rgba(255, 85, 85, 0.1);
}

.modal-title {
  font-size: 24px;
  font-weight: 700;
  background: linear-gradient(90deg, #ff5555, #ffdd00);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.close-btn {
  background: none;
  border: none;
  color: var(--muted);
  font-size: 28px;
  cursor: pointer;
  padding: 0;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 8px;
  transition: all 0.2s;
}

.close-btn:hover {
  background: rgba(255, 85, 85, 0.1);
  color: #ff5555;
}

/* Form Styles */
.form-group {
  margin-bottom: 20px;
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-bottom: 16px;
}

.form-label {
  display: block;
  margin-bottom: 8px;
  font-size: 14px;
  font-weight: 600;
  color: var(--text);
}

.form-input {
  width: 100%;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 85, 85, 0.2);
  border-radius: 8px;
  padding: 12px 16px;
  color: var(--text);
  font-size: 14px;
  transition: all 0.2s;
}

.form-input:focus {
  outline: none;
  border-color: #ff5555;
  box-shadow: 0 0 0 2px rgba(255, 85, 85, 0.2);
}

.form-select {
  width: 100%;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 85, 85, 0.2);
  border-radius: 8px;
  padding: 12px 16px;
  color: var(--text);
  font-size: 14px;
  transition: all 0.2s;
}

.form-select:focus {
  outline: none;
  border-color: #ff5555;
  box-shadow: 0 0 0 2px rgba(255, 85, 85, 0.2);
}

.form-textarea {
  width: 100%;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 85, 85, 0.2);
  border-radius: 8px;
  padding: 12px 16px;
  color: var(--text);
  font-size: 14px;
  min-height: 100px;
  resize: vertical;
  transition: all 0.2s;
}

.form-textarea:focus {
  outline: none;
  border-color: #ff5555;
  box-shadow: 0 0 0 2px rgba(255, 85, 85, 0.2);
}

/* Modal Tabs */
.modal-tabs {
  display: flex;
  gap: 4px;
  margin-bottom: 24px;
  border-bottom: 1px solid rgba(255, 85, 85, 0.1);
}

.modal-tab {
  padding: 12px 24px;
  background: none;
  border: none;
  color: var(--muted);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  transition: all 0.2s;
}

.modal-tab:hover {
  color: var(--text);
}

.modal-tab.active {
  color: #ff5555;
  border-bottom-color: #ff5555;
}

/* Modal Actions */
.modal-actions {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  margin-top: 32px;
  padding-top: 24px;
  border-top: 1px solid rgba(255, 85, 85, 0.1);
}

/* Badge Selector */
.badge-selector {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.badge-option {
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  border: 2px solid transparent;
}

.badge-option:hover {
  transform: translateY(-2px);
}

.badge-option.selected {
  border-color: currentColor;
}

/* Verification Status */
.verification-status {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.03);
  border: 1px solid rgba(255, 85, 85, 0.1);
}

.verification-icon {
  font-size: 20px;
}

.verification-icon.verified {
  color: #4CAF50;
}

.verification-icon.pending {
  color: #ffdd00;
}

.verification-icon.unverified {
  color: #ff6b6b;
}

/* Ride History in Modal */
.ride-history {
  max-height: 200px;
  overflow-y: auto;
  border: 1px solid rgba(255, 85, 85, 0.1);
  border-radius: 8px;
  padding: 8px;
}

.ride-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  border-bottom: 1px solid rgba(255, 85, 85, 0.05);
}

.ride-item:last-child {
  border-bottom: none;
}

.ride-info {
  flex: 1;
}

.ride-route {
  font-weight: 600;
  margin-bottom: 4px;
}

.ride-details {
  font-size: 12px;
  color: var(--muted);
}

.ride-amount {
  font-weight: 700;
  color: #ffdd00;
}

/* Responsive Design */
@media (max-width: 768px) {
  .user-table-container {
    margin: 10px;
    padding: 10px;
    overflow-x: auto;
  }
  
  .user-table {
    min-width: 800px;
  }
  
  .form-row {
    grid-template-columns: 1fr;
  }
  
  .management-actions {
    flex-direction: column;
    align-items: stretch;
  }
  
  .search-input {
    min-width: auto;
  }
  
  .user-stats {
    grid-template-columns: repeat(2, 1fr);
    margin: 10px;
  }
  
  .stat-value {
    font-size: 28px;
  }
}

/* Tab Content Styles */
.modal-tab-content {
  display: none;
}

.modal-tab-content.active {
  display: block;
}
</style>
</head>
<body class="dark">

<!-- SIDEBAR -->
<aside class="sidebar card fade-in">
  <div class="brand">
    <div class="logo">GET</div>
    <div>
      <h2>GetInTheCar</h2>
      <div class="small muted">Admin Dashboard</div>
    </div>
  </div>

  <nav>
    <a href="admin.html">üìä Dashboard</a>
    <a href="usermanage.html" class="active">üë• User Management</a>
    <a href="drivermanage.html">üöó Driver Management</a>
    <a href="index.html">üîê Log Out</a>
  </nav>

  <div class="toggle-row">
    <div class="small muted">Dark Mode</div>
    <div id="darkSwitch" class="switch dark-toggle-on" title="Toggle dark mode">
      <div class="knob"></div>
    </div>
</div>
</aside>

<!-- MAIN -->
<main class="main">
  <!-- User Management Header -->
  <div class="management-header">
    <div class="header-title">User Management</div>
    <div class="small muted">Manage user accounts, permissions, and activity</div>
    
    <div class="user-stats">
      <div class="stat-card">
        <div class="stat-value" id="totalUsers">156</div>
        <div class="stat-label">Total Users</div>
        <div class="stat-change positive">+12 this week</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="onlineUsers">89</div>
        <div class="stat-label">Online Now</div>
        <div class="stat-change positive">56% active</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="newUsers">24</div>
        <div class="stat-label">New This Month</div>
        <div class="stat-change positive">+8% growth</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="suspendedUsers">3</div>
        <div class="stat-label">Suspended</div>
        <div class="stat-change negative">-1 resolved</div>
      </div>
    </div>
  </div>

  <!-- User Management Actions -->
  <div class="management-actions">
    <div class="filter-controls">
      <select class="filter-select" id="statusFilter" onchange="filterUsers()">
        <option value="all">All Status</option>
        <option value="online">Online</option>
        <option value="offline">Offline</option>
        <option value="in-ride">In Ride</option>
        <option value="suspended">Suspended</option>
      </select>
      
      <select class="filter-select" id="verificationFilter" onchange="filterUsers()">
        <option value="all">All Verification</option>
        <option value="verified">Verified</option>
        <option value="pending">Pending</option>
        <option value="unverified">Unverified</option>
      </select>
      
      <input type="text" class="search-input" id="userSearch" placeholder="Search users by name, email, or phone..." oninput="filterUsers()">
    </div>
    
    <div class="action-buttons">
      <button class="small-btn" onclick="exportUsers()" title="Export to CSV">
        üì• Export
      </button>
      <button class="btn" onclick="addNewUser()" title="Add New User">
        + Add User
      </button>
    </div>
  </div>

  <!-- User Table -->
  <div class="user-table-container">
    <table class="user-table">
      <thead>
        <tr>
          <th>
            <label class="toggle-switch">
              <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
              <span class="toggle-slider"></span>
            </label>
          </th>
          <th>User</th>
          <th>Contact</th>
          <th>Status</th>
          <th>Verification</th>
          <th>Rides</th>
          <th>Joined</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="userTableBody">
        <!-- Users will be dynamically inserted here -->
      </tbody>
    </table>
    
    <!-- Pagination -->
    <div class="pagination">
      <button class="page-btn" onclick="changePage(-1)" id="prevPage" disabled>‚Üê</button>
      <button class="page-btn active" onclick="changePage(1)">1</button>
      <button class="page-btn" onclick="changePage(2)">2</button>
      <button class="page-btn" onclick="changePage(3)">3</button>
      <button class="page-btn" onclick="changePage(4)">4</button>
      <button class="page-btn" onclick="changePage(5)">5</button>
      <span class="small muted" style="margin: 0 12px;">...</span>
      <button class="page-btn" onclick="changePage(10)">10</button>
      <button class="page-btn" onclick="changePage(1)" id="nextPage">‚Üí</button>
    </div>
  </div>
</main>

<!-- User Details Modal -->
<div id="userModal" class="modal-overlay" style="display:none;">
  <div class="user-modal">
    <div class="modal-header">
      <div class="modal-title" id="userModalTitle">User Details</div>
      <button class="close-btn" onclick="closeUserModal()">√ó</button>
    </div>
    
    <div class="modal-tabs" style="display: none;">
      <button class="modal-tab active" onclick="switchTab('details')">Details</button>
      <button class="modal-tab" onclick="switchTab('activity')">Activity</button>
      <button class="modal-tab" onclick="switchTab('settings')">Settings</button>
    </div>
    
    <div id="userModalContent">
      <!-- Content will be dynamically inserted -->
    </div>
  </div>
</div>

<!-- Bulk Actions Modal -->
<div id="bulkModal" class="modal-overlay" style="display:none;">
  <div class="user-modal" style="max-width: 400px;">
    <div class="modal-header">
      <div class="modal-title">Bulk Actions</div>
      <button class="close-btn" onclick="closeBulkModal()">√ó</button>
    </div>
    
    <div id="bulkModalContent">
      <div class="form-group">
        <label class="form-label">Selected Users: <span id="selectedCount">0</span></label>
      </div>
      
      <div class="form-group">
        <label class="form-label">Action</label>
        <select class="form-select" id="bulkAction">
          <option value="">Select action...</option>
          <option value="suspend">Suspend Users</option>
          <option value="activate">Activate Users</option>
          <option value="send_email">Send Email</option>
          <option value="export">Export Selected</option>
          <option value="delete">Delete Users</option>
        </select>
      </div>
      
      <div id="bulkActionContent" style="display:none;">
        <!-- Dynamic content based on action -->
      </div>
      
      <div class="modal-actions">
        <button class="small-btn" onclick="closeBulkModal()">Cancel</button>
        <button class="btn" onclick="executeBulkAction()" id="executeBulkBtn" disabled>Execute</button>
      </div>
    </div>
  </div>
</div>

<script>
// Theme toggle logic
const body = document.body;
const darkSwitch = document.getElementById('darkSwitch');
darkSwitch.addEventListener('click', () => {
  const knob = darkSwitch.querySelector('.knob');
  darkSwitch.classList.toggle('dark-toggle-on');
  body.classList.toggle('dark');
  if (body.classList.contains('dark')) {
    knob.style.left = '25px';
    knob.style.boxShadow = '0 10px 30px rgba(255, 221, 0, 0.12)';
  } else {
    knob.style.left = '3px';
    knob.style.boxShadow = '0 6px 18px rgba(255, 59, 48, 0.12)';
  }
});

// Sample User Data
let usersData = [
  {
    id: 1,
    name: 'Alif Mukhlis',
    email: 'alif@uitm.edu.my',
    phone: '+6012-345-6789',
    status: 'online',
    verification: 'verified',
    rides: 24,
    rating: 4.8,
    joined: '2024-01-15',
    lastActive: 'Just now',
    address: 'Kolej Tun Fatimah, UiTM Arau',
    paymentMethods: ['Card', 'e-Wallet'],
    totalSpent: 456.80,
    rideHistory: [
      { date: 'Today, 09:45', from: 'Yasmeen Nasi Kandar', to: 'UiTM Arau', amount: 'RM 12.30', status: 'completed' },
      { date: 'Yesterday, 18:30', from: 'Kolej Dahlia', to: 'Kompleks Star', amount: 'RM 8.50', status: 'completed' },
      { date: 'Dec 10, 15:20', from: 'HEA UITM', to: 'Arau KTM', amount: 'RM 15.20', status: 'completed' }
    ]
  },
  {
    id: 2,
    name: 'Nurul Huda',
    email: 'nurul@uitm.edu.my',
    phone: '+6012-987-6543',
    status: 'in-ride',
    verification: 'verified',
    rides: 18,
    rating: 4.5,
    joined: '2024-02-10',
    lastActive: '2 min ago',
    address: 'Kolej Melati, UiTM Arau',
    paymentMethods: ['Cash'],
    totalSpent: 324.50,
    rideHistory: [
      { date: 'Today, 09:30', from: 'Kolej Dahlia', to: 'Kompleks Star', amount: 'RM 8.50', status: 'ongoing' },
      { date: 'Yesterday, 20:15', from: 'UiTM Arau', to: 'ZUS Coffee', amount: 'RM 6.80', status: 'completed' }
    ]
  },
  {
    id: 3,
    name: 'Ahmad Firdaus',
    email: 'ahmad@uitm.edu.my',
    phone: '+6013-456-7890',
    status: 'offline',
    verification: 'pending',
    rides: 32,
    rating: 4.9,
    joined: '2023-12-05',
    lastActive: '1 hour ago',
    address: 'Kolej Seroja, UiTM Arau',
    paymentMethods: ['Card', 'Cash'],
    totalSpent: 589.20,
    rideHistory: [
      { date: 'Today, 09:15', from: 'HEA UITM', to: 'Arau KTM', amount: 'RM 15.20', status: 'completed' },
      { date: 'Dec 11, 14:45', from: 'Kolej Seroja', to: 'McDonald\'s', amount: 'RM 10.50', status: 'completed' }
    ]
  },
  {
    id: 4,
    name: 'Siti Aminah',
    email: 'siti@uitm.edu.my',
    phone: '+6014-567-8901',
    status: 'online',
    verification: 'verified',
    rides: 15,
    rating: 4.3,
    joined: '2024-01-25',
    lastActive: 'Just now',
    address: 'Kolej Anggerik, UiTM Arau',
    paymentMethods: ['e-Wallet'],
    totalSpent: 245.60,
    rideHistory: [
      { date: 'Today, 09:00', from: 'UiTM Arau', to: 'ZUS Coffee', amount: 'RM 6.80', status: 'completed' },
      { date: 'Dec 10, 19:30', from: 'Kolej Anggerik', to: 'Yasmeen', amount: 'RM 12.30', status: 'completed' }
    ]
  },
  {
    id: 5,
    name: 'Mohd Rizal',
    email: 'rizal@uitm.edu.my',
    phone: '+6015-678-9012',
    status: 'offline',
    verification: 'verified',
    rides: 41,
    rating: 4.7,
    joined: '2023-11-20',
    lastActive: '3 hours ago',
    address: 'Kolej Cempaka, UiTM Arau',
    paymentMethods: ['Card', 'e-Wallet', 'Cash'],
    totalSpent: 678.90,
    rideHistory: [
      { date: 'Today, 08:45', from: 'Kolej Melati', to: 'McDonald\'s', amount: 'RM 10.50', status: 'cancelled' },
      { date: 'Dec 11, 17:20', from: 'Kolej Cempaka', to: 'Kompleks Star', amount: 'RM 8.50', status: 'completed' }
    ]
  },
  {
    id: 6,
    name: 'Fatimah Zahra',
    email: 'fatimah@uitm.edu.my',
    phone: '+6016-789-0123',
    status: 'online',
    verification: 'unverified',
    rides: 22,
    rating: 4.6,
    joined: '2024-02-15',
    lastActive: '5 min ago',
    address: 'Kolej Teratai, UiTM Arau',
    paymentMethods: ['Cash'],
    totalSpent: 312.40,
    rideHistory: [
      { date: 'Today, 08:30', from: 'Kolej Teratai', to: 'HEA UITM', amount: 'RM 15.20', status: 'completed' },
      { date: 'Dec 10, 21:15', from: 'UiTM Arau', to: 'Yasmeen', amount: 'RM 12.30', status: 'completed' }
    ]
  },
  {
    id: 7,
    name: 'Hakim Ismail',
    email: 'hakim@uitm.edu.my',
    phone: '+6017-890-1234',
    status: 'suspended',
    verification: 'verified',
    rides: 8,
    rating: 3.2,
    joined: '2024-02-01',
    lastActive: '2 days ago',
    address: 'Kolej Mawar, UiTM Arau',
    paymentMethods: ['Card'],
    totalSpent: 98.50,
    rideHistory: [
      { date: 'Dec 9, 16:45', from: 'Kolej Mawar', to: 'Arau KTM', amount: 'RM 15.20', status: 'completed' },
      { date: 'Dec 8, 11:30', from: 'UiTM Arau', to: 'ZUS Coffee', amount: 'RM 6.80', status: 'completed' }
    ],
    suspensionReason: 'Multiple payment failures'
  },
  {
    id: 8,
    name: 'Noraisha Zain',
    email: 'noraisha@uitm.edu.my',
    phone: '+6018-901-2345',
    status: 'in-ride',
    verification: 'pending',
    rides: 12,
    rating: 4.4,
    joined: '2024-02-05',
    lastActive: '10 min ago',
    address: 'Kolej Kenanga, UiTM Arau',
    paymentMethods: ['e-Wallet'],
    totalSpent: 187.60,
    rideHistory: [
      { date: 'Today, 08:15', from: 'Kolej Kenanga', to: 'McDonald\'s', amount: 'RM 10.50', status: 'ongoing' },
      { date: 'Dec 11, 13:45', from: 'UiTM Arau', to: 'Kompleks Star', amount: 'RM 8.50', status: 'completed' }
    ]
  }
];

// State Management
let currentPage = 1;
const itemsPerPage = 8;
let selectedUsers = new Set();
let currentTab = 'details';
let editingUserId = null;

// Initialize User Management
function initializeUserManagement() {
  renderUserTable();
  updateStats();
  setupEventListeners();
}

// Render User Table
function renderUserTable(filteredUsers = null) {
  const tbody = document.getElementById('userTableBody');
  const users = filteredUsers || usersData;
  
  // Calculate pagination
  const startIndex = (currentPage - 1) * itemsPerPage;
  const endIndex = startIndex + itemsPerPage;
  const pageUsers = users.slice(startIndex, endIndex);
  
  tbody.innerHTML = '';
  
  pageUsers.forEach(user => {
    const row = document.createElement('tr');
    const isSelected = selectedUsers.has(user.id);
    
    // Get status badge class
    const statusClass = `status-${user.status.replace('-', '')}`;
    const statusText = user.status.replace('-', ' ').toUpperCase();
    
    // Get verification icon
    let verificationIcon, verificationColor;
    switch(user.verification) {
      case 'verified':
        verificationIcon = '‚úì';
        verificationColor = '#4CAF50';
        break;
      case 'pending':
        verificationIcon = '‚è≥';
        verificationColor = '#ffdd00';
        break;
      case 'unverified':
        verificationIcon = '‚úó';
        verificationColor = '#ff6b6b';
        break;
    }
    
    row.innerHTML = `
      <td>
        <label class="toggle-switch">
          <input type="checkbox" ${isSelected ? 'checked' : ''} 
                 onchange="toggleUserSelection(${user.id}, this.checked)">
          <span class="toggle-slider"></span>
        </label>
      </td>
      <td>
        <div class="user-avatar-cell">
          <div class="user-avatar">${user.name.charAt(0)}</div>
          <div>
            <div style="font-weight: 700;">${user.name}</div>
            <div class="small muted">‚≠ê ${user.rating}/5.0</div>
          </div>
        </div>
      </td>
      <td>
        <div>${user.email}</div>
        <div class="small muted">${user.phone}</div>
      </td>
      <td>
        <span class="status-badge ${statusClass}">${statusText}</span>
        <div class="small muted" style="margin-top: 4px;">${user.lastActive}</div>
      </td>
      <td>
        <div style="display: flex; align-items: center; gap: 8px;">
          <span style="color: ${verificationColor}; font-size: 18px;">${verificationIcon}</span>
          <span>${user.verification.charAt(0).toUpperCase() + user.verification.slice(1)}</span>
        </div>
      </td>
      <td>
        <div style="font-weight: 700;">${user.rides}</div>
        <div class="small muted">RM ${user.totalSpent?.toFixed(2) || '0.00'}</div>
      </td>
      <td>
        <div>${formatDate(user.joined)}</div>
        <div class="small muted">${getDaysAgo(user.joined)} days ago</div>
      </td>
      <td>
        <div class="action-buttons-cell">
          <button class="action-btn view" onclick="viewUser(${user.id})" title="View Details">
            üëÅÔ∏è
          </button>
          <button class="action-btn edit" onclick="editUser(${user.id})" title="Edit User">
            ‚úèÔ∏è
          </button>
          <button class="action-btn delete" onclick="deleteUser(${user.id})" title="Delete User">
            üóëÔ∏è
          </button>
        </div>
      </td>
    `;
    
    tbody.appendChild(row);
  });
  
  updatePagination(users.length);
  updateBulkActions();
}

// Filter Users
function filterUsers() {
  const statusFilter = document.getElementById('statusFilter').value;
  const verificationFilter = document.getElementById('verificationFilter').value;
  const searchTerm = document.getElementById('userSearch').value.toLowerCase();
  
  let filtered = usersData;
  
  // Apply status filter
  if (statusFilter !== 'all') {
    filtered = filtered.filter(user => user.status === statusFilter);
  }
  
  // Apply verification filter
  if (verificationFilter !== 'all') {
    filtered = filtered.filter(user => user.verification === verificationFilter);
  }
  
  // Apply search filter
  if (searchTerm) {
    filtered = filtered.filter(user => 
      user.name.toLowerCase().includes(searchTerm) ||
      user.email.toLowerCase().includes(searchTerm) ||
      user.phone.includes(searchTerm)
    );
  }
  
  renderUserTable(filtered);
}

// Update Statistics
function updateStats() {
  const totalUsers = usersData.length;
  const onlineUsers = usersData.filter(u => u.status === 'online' || u.status === 'in-ride').length;
  const newUsers = usersData.filter(u => getDaysAgo(u.joined) <= 30).length;
  const suspendedUsers = usersData.filter(u => u.status === 'suspended').length;
  
  document.getElementById('totalUsers').textContent = totalUsers;
  document.getElementById('onlineUsers').textContent = onlineUsers;
  document.getElementById('newUsers').textContent = newUsers;
  document.getElementById('suspendedUsers').textContent = suspendedUsers;
}

// Toggle User Selection
function toggleUserSelection(userId, isSelected) {
  if (isSelected) {
    selectedUsers.add(userId);
  } else {
    selectedUsers.delete(userId);
  }
  
  updateSelectAllCheckbox();
  updateBulkActions();
}

// Toggle Select All
function toggleSelectAll() {
  const selectAll = document.getElementById('selectAll').checked;
  const checkboxes = document.querySelectorAll('#userTableBody input[type="checkbox"]');
  
  checkboxes.forEach(checkbox => {
    const userId = parseInt(checkbox.getAttribute('onchange').match(/\d+/)[0]);
    checkbox.checked = selectAll;
    
    if (selectAll) {
      selectedUsers.add(userId);
    } else {
      selectedUsers.delete(userId);
    }
  });
  
  updateBulkActions();
}

// Update Select All Checkbox
function updateSelectAllCheckbox() {
  const checkboxes = document.querySelectorAll('#userTableBody input[type="checkbox"]');
  const allChecked = checkboxes.length > 0 && Array.from(checkboxes).every(cb => cb.checked);
  document.getElementById('selectAll').checked = allChecked;
}

// Update Bulk Actions
function updateBulkActions() {
  const selectedCount = selectedUsers.size;
  document.getElementById('selectedCount').textContent = selectedCount;
}

// View User Details
function viewUser(userId) {
  const user = usersData.find(u => u.id === userId);
  if (!user) return;
  
  editingUserId = userId;
  document.getElementById('userModalTitle').textContent = 'User Details';
  
  // Show modal tabs
  document.querySelector('.modal-tabs').style.display = 'flex';
  
  // Create modal content with all tabs
  let content = `
    <div id="detailsTab" class="modal-tab-content active">
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Full Name</label>
          <div class="form-input" style="background: rgba(255,255,255,0.02);">${user.name}</div>
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <div class="form-input" style="background: rgba(255,255,255,0.02);">${user.email}</div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Phone Number</label>
          <div class="form-input" style="background: rgba(255,255,255,0.02);">${user.phone}</div>
        </div>
        <div class="form-group">
          <label class="form-label">Status</label>
          <div class="status-badge status-${user.status.replace('-', '')}" style="display: inline-block;">
            ${user.status.replace('-', ' ').toUpperCase()}
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label class="form-label">Address</label>
        <div class="form-input" style="background: rgba(255,255,255,0.02);">${user.address}</div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Total Rides</label>
          <div class="form-input" style="background: rgba(255,255,255,0.02);">${user.rides}</div>
        </div>
        <div class="form-group">
          <label class="form-label">Total Spent</label>
          <div class="form-input" style="background: rgba(255,255,255,0.02);">RM ${user.totalSpent?.toFixed(2) || '0.00'}</div>
        </div>
      </div>
      
      <div class="form-group">
        <label class="form-label">Payment Methods</label>
        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
          ${user.paymentMethods.map(method => 
            `<span class="status-badge" style="background: rgba(255, 85, 85, 0.1); color: #ff5555;">${method}</span>`
          ).join('')}
        </div>
      </div>
      
      ${user.suspensionReason ? `
        <div class="form-group">
          <label class="form-label">Suspension Reason</label>
          <div class="form-input" style="background: rgba(255,107,107,0.1); color: #ff6b6b;">
            ${user.suspensionReason}
          </div>
        </div>
      ` : ''}
    </div>
    
    <div id="activityTab" class="modal-tab-content">
      <div class="form-group">
        <label class="form-label">Recent Ride History</label>
        <div class="ride-history">
          ${user.rideHistory.map(ride => `
            <div class="ride-item">
              <div class="ride-info">
                <div class="ride-route">${ride.from} ‚Üí ${ride.to}</div>
                <div class="ride-details">${ride.date} ‚Ä¢ ${ride.status}</div>
              </div>
              <div class="ride-amount">${ride.amount}</div>
            </div>
          `).join('')}
          ${user.rideHistory.length === 0 ? 
            '<div style="text-align: center; padding: 20px; color: var(--muted);">No ride history available</div>' : 
            ''}
        </div>
      </div>
      
      <div class="form-group">
        <label class="form-label">User Statistics</label>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
          <div style="padding: 12px; background: rgba(255,255,255,0.02); border-radius: 8px; text-align: center;">
            <div style="font-size: 24px; font-weight: 700; color: #ff5555;">${user.rides}</div>
            <div class="small muted">Total Rides</div>
          </div>
          <div style="padding: 12px; background: rgba(255,255,255,0.02); border-radius: 8px; text-align: center;">
            <div style="font-size: 24px; font-weight: 700; color: #ffdd00;">${user.rating}</div>
            <div class="small muted">Average Rating</div>
          </div>
          <div style="padding: 12px; background: rgba(255,255,255,0.02); border-radius: 8px; text-align: center;">
            <div style="font-size: 24px; font-weight: 700; color: #4CAF50;">RM ${user.totalSpent?.toFixed(2) || '0.00'}</div>
            <div class="small muted">Total Spent</div>
          </div>
          <div style="padding: 12px; background: rgba(255,255,255,0.02); border-radius: 8px; text-align: center;">
            <div style="font-size: 24px; font-weight: 700; color: #9fa8da;">${getDaysAgo(user.joined)}</div>
            <div class="small muted">Days as User</div>
          </div>
        </div>
      </div>
    </div>
    
    <div id="settingsTab" class="modal-tab-content">
      <div class="form-group">
        <label class="form-label">Account Status</label>
        <select class="form-select" id="userAccountStatus">
          <option value="active" ${user.status !== 'suspended' ? 'selected' : ''}>Active</option>
          <option value="suspended" ${user.status === 'suspended' ? 'selected' : ''}>Suspended</option>
        </select>
      </div>
      
      <div class="form-group">
        <label class="form-label">Verification Status</label>
        <select class="form-select" id="userVerificationStatus">
          <option value="verified" ${user.verification === 'verified' ? 'selected' : ''}>Verified</option>
          <option value="pending" ${user.verification === 'pending' ? 'selected' : ''}>Pending</option>
          <option value="unverified" ${user.verification === 'unverified' ? 'selected' : ''}>Unverified</option>
        </select>
      </div>
      
      <div class="form-group">
        <label class="form-label">User Notes</label>
        <textarea class="form-textarea" id="userNotes" placeholder="Add notes about this user..."></textarea>
      </div>
      
      <div class="modal-actions">
        <button class="small-btn" onclick="closeUserModal()">Cancel</button>
        <button class="btn" onclick="saveUserSettings()">Save Changes</button>
      </div>
    </div>
  `;
  
  document.getElementById('userModalContent').innerHTML = content;
  document.getElementById('userModal').style.display = 'flex';
  currentTab = 'details';
  
  // Set active tab
  document.querySelectorAll('.modal-tab').forEach(tab => {
    tab.classList.remove('active');
  });
  document.querySelector('.modal-tab').classList.add('active');
}

// Edit User
function editUser(userId) {
  const user = usersData.find(u => u.id === userId);
  if (!user) return;
  
  editingUserId = userId;
  document.getElementById('userModalTitle').textContent = 'Edit User';
  
  // Hide modal tabs for edit mode
  document.querySelector('.modal-tabs').style.display = 'none';
  
  let content = `
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Full Name *</label>
        <input type="text" class="form-input" id="editUserName" value="${user.name}" required>
      </div>
      <div class="form-group">
        <label class="form-label">Email *</label>
        <input type="email" class="form-input" id="editUserEmail" value="${user.email}" required>
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Phone Number *</label>
        <input type="tel" class="form-input" id="editUserPhone" value="${user.phone}" required>
      </div>
      <div class="form-group">
        <label class="form-label">Status</label>
        <select class="form-select" id="editUserStatus">
          <option value="online" ${user.status === 'online' ? 'selected' : ''}>Online</option>
          <option value="offline" ${user.status === 'offline' ? 'selected' : ''}>Offline</option>
          <option value="in-ride" ${user.status === 'in-ride' ? 'selected' : ''}>In Ride</option>
          <option value="suspended" ${user.status === 'suspended' ? 'selected' : ''}>Suspended</option>
        </select>
      </div>
    </div>
    
    <div class="form-group">
      <label class="form-label">Address</label>
      <input type="text" class="form-input" id="editUserAddress" value="${user.address}">
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Verification Status</label>
        <select class="form-select" id="editUserVerification">
          <option value="verified" ${user.verification === 'verified' ? 'selected' : ''}>Verified</option>
          <option value="pending" ${user.verification === 'pending' ? 'selected' : ''}>Pending</option>
          <option value="unverified" ${user.verification === 'unverified' ? 'selected' : ''}>Unverified</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Rating</label>
        <input type="number" class="form-input" id="editUserRating" value="${user.rating}" min="0" max="5" step="0.1">
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Total Rides</label>
        <input type="number" class="form-input" id="editUserRides" value="${user.rides}" min="0">
      </div>
      <div class="form-group">
        <label class="form-label">Total Spent (RM)</label>
        <input type="number" class="form-input" id="editUserTotalSpent" value="${user.totalSpent}" step="0.01" min="0">
      </div>
    </div>
    
    ${user.suspensionReason ? `
      <div class="form-group">
        <label class="form-label">Suspension Reason</label>
        <textarea class="form-textarea" id="editSuspensionReason">${user.suspensionReason}</textarea>
      </div>
    ` : ''}
    
    <div class="modal-actions">
      <button class="small-btn" onclick="closeUserModal()">Cancel</button>
      <button class="btn" onclick="saveUserChanges()">Save Changes</button>
      <button class="small-btn" style="background: rgba(255, 107, 107, 0.1); color: #ff6b6b;" 
              onclick="confirmDeleteUser(${userId})">
        Delete User
      </button>
    </div>
  `;
  
  document.getElementById('userModalContent').innerHTML = content;
  document.getElementById('userModal').style.display = 'flex';
}

// Save User Changes
function saveUserChanges() {
  const userIndex = usersData.findIndex(u => u.id === editingUserId);
  if (userIndex === -1) return;
  
  const name = document.getElementById('editUserName').value;
  const email = document.getElementById('editUserEmail').value;
  const phone = document.getElementById('editUserPhone').value;
  const status = document.getElementById('editUserStatus').value;
  const address = document.getElementById('editUserAddress').value;
  const verification = document.getElementById('editUserVerification').value;
  const rating = parseFloat(document.getElementById('editUserRating').value);
  const rides = parseInt(document.getElementById('editUserRides').value);
  const totalSpent = parseFloat(document.getElementById('editUserTotalSpent').value);
  const suspensionReason = document.getElementById('editSuspensionReason')?.value;
  
  if (!name || !email || !phone) {
    showNotification('Please fill all required fields!', 'error');
    return;
  }
  
  usersData[userIndex] = {
    ...usersData[userIndex],
    name,
    email,
    phone,
    status,
    address,
    verification,
    rating,
    rides,
    totalSpent,
    ...(suspensionReason && { suspensionReason })
  };
  
  // Update last active based on status
  if (status === 'online' || status === 'in-ride') {
    usersData[userIndex].lastActive = 'Just now';
  } else if (status === 'offline') {
    usersData[userIndex].lastActive = '1 hour ago';
  }
  
  renderUserTable();
  updateStats();
  closeUserModal();
  showNotification('User updated successfully!', 'success');
}

// Save User Settings
function saveUserSettings() {
  const userIndex = usersData.findIndex(u => u.id === editingUserId);
  if (userIndex === -1) return;
  
  const accountStatus = document.getElementById('userAccountStatus').value;
  const verificationStatus = document.getElementById('userVerificationStatus').value;
  
  usersData[userIndex].status = accountStatus === 'active' ? 'online' : 'suspended';
  usersData[userIndex].verification = verificationStatus;
  
  renderUserTable();
  updateStats();
  closeUserModal();
  showNotification('User settings updated!', 'success');
}

// Add New User
function addNewUser() {
  editingUserId = null;
  document.getElementById('userModalTitle').textContent = 'Add New User';
  
  // Hide modal tabs for add new user
  document.querySelector('.modal-tabs').style.display = 'none';
  
  const content = `
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Full Name *</label>
        <input type="text" class="form-input" id="newUserName" placeholder="Enter full name" required>
      </div>
      <div class="form-group">
        <label class="form-label">Email *</label>
        <input type="email" class="form-input" id="newUserEmail" placeholder="Enter email address" required>
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Phone Number *</label>
        <input type="tel" class="form-input" id="newUserPhone" placeholder="Enter phone number" required>
      </div>
      <div class="form-group">
        <label class="form-label">Password *</label>
        <input type="password" class="form-input" id="newUserPassword" placeholder="Enter password" required>
      </div>
    </div>
    
    <div class="form-group">
      <label class="form-label">Address</label>
      <input type="text" class="form-input" id="newUserAddress" placeholder="Enter address">
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">User Type</label>
        <select class="form-select" id="newUserType">
          <option value="student">Student</option>
          <option value="staff">Staff</option>
          <option value="visitor">Visitor</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Initial Status</label>
        <select class="form-select" id="newUserStatus">
          <option value="online">Online</option>
          <option value="offline">Offline</option>
        </select>
      </div>
    </div>
    
    <div class="modal-actions">
      <button class="small-btn" onclick="closeUserModal()">Cancel</button>
      <button class="btn" onclick="createNewUser()">Create User</button>
    </div>
  `;
  
  document.getElementById('userModalContent').innerHTML = content;
  document.getElementById('userModal').style.display = 'flex';
}

// Create New User
function createNewUser() {
  const name = document.getElementById('newUserName').value;
  const email = document.getElementById('newUserEmail').value;
  const phone = document.getElementById('newUserPhone').value;
  const password = document.getElementById('newUserPassword').value;
  const address = document.getElementById('newUserAddress').value;
  const userType = document.getElementById('newUserType').value;
  const status = document.getElementById('newUserStatus').value;
  
  if (!name || !email || !phone || !password) {
    showNotification('Please fill all required fields!', 'error');
    return;
  }
  
  const newId = Math.max(...usersData.map(u => u.id)) + 1;
  const newUser = {
    id: newId,
    name,
    email,
    phone,
    status,
    verification: 'pending',
    rides: 0,
    rating: 5.0,
    joined: new Date().toISOString().split('T')[0],
    lastActive: status === 'online' ? 'Just now' : '1 hour ago',
    address: address || 'Not specified',
    paymentMethods: [],
    totalSpent: 0,
    rideHistory: [],
    userType
  };
  
  usersData.unshift(newUser);
  renderUserTable();
  updateStats();
  closeUserModal();
  showNotification('User created successfully!', 'success');
}

// Delete User
function deleteUser(userId) {
  if (confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
    confirmDeleteUser(userId);
  }
}

// Confirm Delete User
function confirmDeleteUser(userId) {
  if (confirm('This will permanently delete the user and all their data. Are you absolutely sure?')) {
    const index = usersData.findIndex(u => u.id === userId);
    if (index !== -1) {
      usersData.splice(index, 1);
      selectedUsers.delete(userId);
      renderUserTable();
      updateStats();
      closeUserModal();
      showNotification('User deleted successfully!', 'success');
    }
  }
}

// Switch Tab in Modal
function switchTab(tabName) {
  currentTab = tabName;
  
  // Update tab buttons
  document.querySelectorAll('.modal-tab').forEach(tab => {
    tab.classList.remove('active');
    if (tab.textContent.toLowerCase().includes(tabName)) {
      tab.classList.add('active');
    }
  });
  
  // Update tab content
  document.querySelectorAll('.modal-tab-content').forEach(content => {
    content.classList.remove('active');
  });
  
  const activeTab = document.getElementById(`${tabName}Tab`);
  if (activeTab) {
    activeTab.classList.add('active');
  }
}

// Open Bulk Actions
function openBulkActions() {
  if (selectedUsers.size === 0) {
    showNotification('Please select users first!', 'error');
    return;
  }
  
  document.getElementById('bulkModal').style.display = 'flex';
  document.getElementById('bulkAction').value = '';
  document.getElementById('bulkActionContent').style.display = 'none';
  document.getElementById('executeBulkBtn').disabled = true;
}

// Close Bulk Modal
function closeBulkModal() {
  document.getElementById('bulkModal').style.display = 'none';
}

// Update Bulk Action Content
function updateBulkAction() {
  const action = document.getElementById('bulkAction').value;
  const contentDiv = document.getElementById('bulkActionContent');
  const executeBtn = document.getElementById('executeBulkBtn');
  
  if (!action) {
    contentDiv.style.display = 'none';
    executeBtn.disabled = true;
    return;
  }
  
  executeBtn.disabled = false;
  contentDiv.style.display = 'block';
  
  switch(action) {
    case 'suspend':
      contentDiv.innerHTML = `
        <div class="form-group">
          <label class="form-label">Suspension Reason</label>
          <textarea class="form-textarea" id="bulkSuspensionReason" 
                    placeholder="Enter reason for suspension..."></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Duration</label>
          <select class="form-select" id="bulkSuspensionDuration">
            <option value="1">1 Day</option>
            <option value="7">1 Week</option>
            <option value="30">1 Month</option>
            <option value="permanent">Permanent</option>
          </select>
        </div>
      `;
      break;
      
    case 'activate':
      contentDiv.innerHTML = `
        <div class="form-group" style="background: rgba(76, 175, 80, 0.1); padding: 16px; border-radius: 8px;">
          <div style="color: #4CAF50; font-weight: 600;">Activate ${selectedUsers.size} selected user(s)</div>
          <div class="small" style="color: var(--muted); margin-top: 4px;">
            This will activate all suspended users in the selection.
          </div>
        </div>
      `;
      break;
      
    case 'send_email':
      contentDiv.innerHTML = `
        <div class="form-group">
          <label class="form-label">Subject</label>
          <input type="text" class="form-input" id="bulkEmailSubject" placeholder="Email subject">
        </div>
        <div class="form-group">
          <label class="form-label">Message</label>
          <textarea class="form-textarea" id="bulkEmailMessage" 
                    placeholder="Enter your message..." rows="4"></textarea>
        </div>
      `;
      break;
      
    case 'export':
      contentDiv.innerHTML = `
        <div class="form-group" style="background: rgba(255, 221, 0, 0.1); padding: 16px; border-radius: 8px;">
          <div style="color: #ffdd00; font-weight: 600;">Export ${selectedUsers.size} user(s)</div>
          <div class="small" style="color: var(--muted); margin-top: 4px;">
            This will export the selected users to a CSV file.
          </div>
        </div>
      `;
      break;
      
    case 'delete':
      contentDiv.innerHTML = `
        <div class="form-group" style="background: rgba(255, 107, 107, 0.1); padding: 16px; border-radius: 8px;">
          <div style="color: #ff6b6b; font-weight: 600; margin-bottom: 8px;">‚ö†Ô∏è Warning</div>
          <div class="small" style="color: var(--muted);">
            This will permanently delete ${selectedUsers.size} user(s) and all their data. 
            This action cannot be undone.
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Confirmation</label>
          <input type="text" class="form-input" id="bulkDeleteConfirm" 
                 placeholder="Type 'DELETE' to confirm">
        </div>
      `;
      break;
      
    default:
      contentDiv.innerHTML = '';
  }
}

// Execute Bulk Action
function executeBulkAction() {
  const action = document.getElementById('bulkAction').value;
  let message = '';
  
  switch(action) {
    case 'suspend':
      const reason = document.getElementById('bulkSuspensionReason').value;
      const duration = document.getElementById('bulkSuspensionDuration').value;
      
      selectedUsers.forEach(userId => {
        const user = usersData.find(u => u.id === userId);
        if (user) {
          user.status = 'suspended';
          user.suspensionReason = reason || 'Administrative suspension';
          user.lastActive = '2 days ago';
        }
      });
      
      message = `Suspended ${selectedUsers.size} user(s)`;
      break;
      
    case 'activate':
      let activatedCount = 0;
      selectedUsers.forEach(userId => {
        const user = usersData.find(u => u.id === userId);
        if (user && user.status === 'suspended') {
          user.status = 'online';
          user.suspensionReason = undefined;
          user.lastActive = 'Just now';
          activatedCount++;
        }
      });
      
      message = `Activated ${activatedCount} user(s)`;
      break;
      
    case 'send_email':
      const subject = document.getElementById('bulkEmailSubject').value;
      const emailMessage = document.getElementById('bulkEmailMessage').value;
      
      // In a real app, this would send emails via API
      console.log(`Sending email to ${selectedUsers.size} users:`, { subject, message: emailMessage });
      message = `Email sent to ${selectedUsers.size} user(s)`;
      break;
      
    case 'export':
      exportSelectedUsers();
      closeBulkModal();
      return;
      
    case 'delete':
      const confirmText = document.getElementById('bulkDeleteConfirm').value;
      if (confirmText !== 'DELETE') {
        showNotification('Please type DELETE to confirm', 'error');
        return;
      }
      
      // Filter out selected users
      const deletedCount = selectedUsers.size;
      usersData = usersData.filter(user => !selectedUsers.has(user.id));
      selectedUsers.clear();
      message = `Deleted ${deletedCount} user(s)`;
      break;
  }
  
  renderUserTable();
  updateStats();
  closeBulkModal();
  showNotification(message, 'success');
}

// Export Users
function exportUsers() {
  // Create CSV content
  const headers = ['Name', 'Email', 'Phone', 'Status', 'Verification', 'Rides', 'Joined', 'Total Spent'];
  const csvContent = [
    headers.join(','),
    ...usersData.map(user => [
      `"${user.name}"`,
      `"${user.email}"`,
      `"${user.phone}"`,
      `"${user.status}"`,
      `"${user.verification}"`,
      user.rides,
      `"${user.joined}"`,
      user.totalSpent || 0
    ].join(','))
  ].join('\n');
  
  // Create download link
  const blob = new Blob([csvContent], { type: 'text/csv' });
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `users_${new Date().toISOString().split('T')[0]}.csv`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  window.URL.revokeObjectURL(url);
  
  showNotification('Users exported successfully!', 'success');
}

// Export Selected Users
function exportSelectedUsers() {
  if (selectedUsers.size === 0) return;
  
  const selectedUsersData = usersData.filter(user => selectedUsers.has(user.id));
  const headers = ['Name', 'Email', 'Phone', 'Status', 'Verification', 'Rides', 'Joined', 'Total Spent'];
  const csvContent = [
    headers.join(','),
    ...selectedUsersData.map(user => [
      `"${user.name}"`,
      `"${user.email}"`,
      `"${user.phone}"`,
      `"${user.status}"`,
      `"${user.verification}"`,
      user.rides,
      `"${user.joined}"`,
      user.totalSpent || 0
    ].join(','))
  ].join('\n');
  
  const blob = new Blob([csvContent], { type: 'text/csv' });
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `selected_users_${new Date().toISOString().split('T')[0]}.csv`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  window.URL.revokeObjectURL(url);
  
  showNotification(`${selectedUsers.size} users exported!`, 'success');
}

// Pagination Functions
function changePage(pageNum) {
  currentPage = pageNum;
  renderUserTable();
  updatePaginationButtons();
}

function updatePagination(totalItems) {
  const totalPages = Math.ceil(totalItems / itemsPerPage);
  const pagination = document.querySelector('.pagination');
  
  // Simple pagination - in a real app, you'd generate dynamic page numbers
  if (totalPages <= 1) {
    pagination.style.display = 'none';
  } else {
    pagination.style.display = 'flex';
  }
}

function updatePaginationButtons() {
  const prevBtn = document.getElementById('prevPage');
  const nextBtn = document.getElementById('nextPage');
  
  prevBtn.disabled = currentPage === 1;
  // In a real app, you'd know the total pages
  // nextBtn.disabled = currentPage === totalPages;
}

// Close User Modal
function closeUserModal() {
  document.getElementById('userModal').style.display = 'none';
  editingUserId = null;
  
  // Reset to first tab for next time
  currentTab = 'details';
  document.querySelector('.modal-tabs').style.display = 'none';
  
  // Reset tab buttons
  document.querySelectorAll('.modal-tab').forEach((tab, index) => {
    tab.classList.remove('active');
    if (index === 0) tab.classList.add('active');
  });
}

// Helper Functions
function formatDate(dateString) {
  const date = new Date(dateString);
  return date.toLocaleDateString('en-US', { 
    year: 'numeric', 
    month: 'short', 
    day: 'numeric' 
  });
}

function getDaysAgo(dateString) {
  const date = new Date(dateString);
  const now = new Date();
  const diffTime = Math.abs(now - date);
  return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
}

// Show Notification
function showNotification(message, type) {
  // Remove existing notifications
  document.querySelectorAll('.notification').forEach(n => n.remove());
  
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  notification.innerHTML = `
    <div style="display: flex; align-items: center; gap: 12px;">
      <div style="font-size: 20px;">
        ${type === 'success' ? '‚úì' : type === 'error' ? '‚úó' : '‚ö†Ô∏è'}
      </div>
      <div>${message}</div>
    </div>
  `;
  
  notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${type === 'success' ? 'rgba(76, 175, 80, 0.15)' : 
                 type === 'error' ? 'rgba(255, 107, 107, 0.15)' : 
                 'rgba(255, 221, 0, 0.15)'};
    border: 1px solid ${type === 'success' ? 'rgba(76, 175, 80, 0.3)' : 
                       type === 'error' ? 'rgba(255, 107, 107, 0.3)' : 
                       'rgba(255, 221, 0, 0.3)'};
    color: ${type === 'success' ? '#4CAF50' : 
            type === 'error' ? '#ff6b6b' : '#ffdd00'};
    padding: 16px 24px;
    border-radius: 12px;
    backdrop-filter: blur(10px);
    z-index: 10000;
    animation: slideIn 0.3s ease-out;
  `;
  
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.style.animation = 'slideOut 0.3s ease-out';
    setTimeout(() => {
      if (notification.parentNode) {
        document.body.removeChild(notification);
      }
    }, 300);
  }, 3000);
}

// Setup Event Listeners
function setupEventListeners() {
  // Bulk action change listener
  document.getElementById('bulkAction').addEventListener('change', updateBulkAction);
  
  // Close modals when clicking outside
  document.addEventListener('click', (e) => {
    if (e.target.classList.contains('modal-overlay')) {
      closeUserModal();
      closeBulkModal();
    }
  });
  
  // Close modals with Escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      closeUserModal();
      closeBulkModal();
    }
  });
}

// Initialize on load
document.addEventListener('DOMContentLoaded', initializeUserManagement);

// Add CSS animations
const style = document.createElement('style');
style.textContent = `
  @keyframes slideIn {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  @keyframes slideOut {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(100%);
      opacity: 0;
    }
  }
  
  .toggle-switch {
    position: relative;
    width: 40px;
    height: 20px;
  }
  
  .toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }
  
  .toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(255, 85, 85, 0.2);
    transition: .4s;
    border-radius: 34px;
  }
  
  .toggle-slider:before {
    position: absolute;
    content: "";
    height: 14px;
    width: 14px;
    left: 3px;
    bottom: 3px;
    background-color: #0a0a0f;
    transition: .4s;
    border-radius: 50%;
  }
  
  input:checked + .toggle-slider {
    background: linear-gradient(90deg, #ff5555, #ffdd00);
  }
  
  input:checked + .toggle-slider:before {
    transform: translateX(20px);
  }
`;
document.head.appendChild(style);
</script>
</body>
</html>